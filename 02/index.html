<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Highlight VƒÉn B·∫£n Theo Audio</title>
D <style>
    body {
      display: flex;
      flex-direction: column;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      width: 100%;
    }

    .highlight {
      background-color: yellow;
    }

    .word {
      display: inline-block;
      margin-right: 5px;
    }

    .chat-container {
      display: inline-flex;
      flex-direction: column;
      width: 1140px;
      margin: auto;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }

    .chat-box {
      height: 300px;
      overflow-y: auto;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
      padding: 5px;
    }

    .user {
      color: #5e5e5e;
    }

    .bot {
      color: #9d9d9d;
    }

    input,
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
    }

    #user-input {
      flex: 1;
      width: auto;
    }

    .container-1140 {
      max-width: 1140px;
      width: 100%;
      padding: 12px;
    }

    .audio-container {
      flex-direction: column;
      gap: 32px;
      width: 100%;
      margin: auto;
      padding-top: 64px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 64px;
    }

    .title {
      font-size: 16px;
      text-align: center;
      color: #5d5d5d;
      padding: 12px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="container-1140 chat-container" style="margin-bottom: 12px; margin-top: 12px;">
    <div class="title">Deepseek nh∆∞ng l√† ·ªü m·ªôt di·ªÖn bi·∫øn kh√°c</div>
  </div>

  <div class="chat-container container-1140">
    <div class="chat-box" id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Nh·∫≠p tin nh·∫Øn..." />
    <button id="send-button" onclick="sendMessage()">G·ª≠i</button>
  </div>


  <script>
    let textJs = [];
    let stampJs = [];
    var messages = [];

    // 1Ô∏è‚É£ KH·ªêI C·∫§U H√åNH API
    const API_CONFIG = {
      url: "https://api.groq.com/openai/v1/chat/completions",
      key: "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", // Thay b·∫±ng API Key th·ª±c t·∫ø
      model: "deepseek-r1-distill-qwen-32b",
      temperature: 0.8,
      max_tokens: 1024
    };

    // 2Ô∏è‚É£ KH·ªêI G·ªåI API
    async function fetchGroqResponse(messages) {
      try {
        const response = await fetch(API_CONFIG.url, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${API_CONFIG.key}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: API_CONFIG.model,
            messages: messages,
            temperature: API_CONFIG.temperature,
            max_tokens: API_CONFIG.max_tokens
          })
        });

        if (!response.ok) {
          throw new Error(`L·ªói HTTP! M√£ tr·∫°ng th√°i: ${response.status}`);
        }

        return await response.json(); // Tr·∫£ v·ªÅ d·ªØ li·ªáu JSON t·ª´ API
      } catch (error) {
        console.error("‚ùå L·ªói khi g·ªçi API:", error);
        return null;
      }
    }

    // 3Ô∏è‚É£ KH·ªêI X·ª¨ L√ù PH·∫¢N H·ªíI
    function handleResponse(data) {
      if (data && data.choices && data.choices.length > 0) {
        console.log("‚úÖ Ph·∫£n h·ªìi t·ª´ Groq API:", data);
        console.log("üí¨ AI Tr·∫£ l·ªùi:", data.choices[0].message.content);
      } else {
        console.log("‚ö†Ô∏è Kh√¥ng c√≥ ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ API.");
      }
    }

    // 4Ô∏è‚É£ KH·ªêI CH·∫†Y CH∆Ø∆†NG TR√åNH
    async function runChat() {
      var messages = [
        { role: "system", content: "T√¥i l√† Deepseek ch·ªâ n√≥i ti·∫øng vi·ªát ng·∫Øn g·ªçn, ƒë∆°n gi·∫£n, d·ªÖ hi·ªÉu, r√µ r√†ng, th√¢n thi·ªán, c√≥ xu·ªëng h√†ng ƒë·∫ßy ƒë·ªß, lu√¥n c·ª• th·ªÉ, kh√¥ng tr·∫£ l·ªùi h·∫øt lan man. T√¥i lu√¥n mu·ªën ng·∫Øn g·ªçn 100%." },
      ];

      const apiResponse = await fetchGroqResponse(messages);
      handleResponse(apiResponse);
    }

    // 2Ô∏è‚É£ H√ÄM V·∫º TIN NH·∫ÆN
    async function sendMessage() {
      var userInput = document.getElementById("user-input");
      var chatBox = document.getElementById("chat-box");

      let userText = userInput.value.trim();
      if (userText === "") return; // Kh√¥ng g·ª≠i tin nh·∫Øn r·ªóng

      // Hi·ªÉn th·ªã tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng
      chatBox.innerHTML += `<p class="user">B·∫°n: ${userText}</p>`;
      userInput.value = ""; // X√≥a input sau khi g·ª≠i
      chatBox.scrollTop = chatBox.scrollHeight; // Cu·ªôn xu·ªëng cu·ªëi khi user g·ª≠i text

      // Th√™m tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng v√†o m·∫£ng `messages`
      messages.push({ role: "user", content: userText });

      // G·ªçi API ƒë·ªÉ nh·∫≠n ph·∫£n h·ªìi t·ª´ chatbot (c√≥ can thi·ªáp th·∫ª <think></think>)
      let botResponse = await fetchGroqResponse(messages);
      var content = botResponse.choices[0].message.content.replace(/<think>.*?<\/think>/gs, "").trim();

      // Hi·ªÉn th·ªã ph·∫£n h·ªìi t·ª´ chatbot
      chatBox.innerHTML += `<p class="bot">üí¨ Tr·∫£ l·ªùi: ${content}</p>`;
      chatBox.scrollTop = chatBox.scrollHeight; // Cu·ªôn xu·ªëng cu·ªëi khi bot tr·∫£ text

      // L∆∞u ph·∫£n h·ªìi c·ªßa bot v√†o l·ªãch s·ª≠ h·ªôi tho·∫°i
      messages.push({ role: "assistant", content: content });
    }


    // G·ªçi h√†m ƒë·ªÉ ch·∫°y ch∆∞∆°ng tr√¨nh
    runChat();

    // L·ªánh t·ª± g·ª≠i khi b·∫•m Enter
    document.getElementById("user-input").addEventListener("keydown", function (event) {
      if (event.key === "Enter") {  // Ki·ªÉm tra n·∫øu ph√≠m Enter ƒë∆∞·ª£c nh·∫•n
        event.preventDefault();  // NgƒÉn ch·∫∑n xu·ªëng d√≤ng trong √¥ input
        document.getElementById("send-button").click();  // K√≠ch ho·∫°t n√∫t
      }
    });

  </script>

</body>

</html>